<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.aonproject.client.order.dao.OrderDAO">
	<select id="cartList" parameterType="cart" resultType="cart">
		select end1.p_no, p_name, p_type, p_price, p_discount, p_color, p_size, pi_route, pi_file , color_code, size_code from
		(select p_no, p_name, p_type, p_price, p_discount, p_color, cc_name as p_size, color_code, size_code from
		(select p_no, p_name, p_type, p_price, p_discount, cc_name as p_color, color_code, size_code from
		(select p_no, p_name, cc_name as p_type, p_price, p_discount, color_code, size_code from 
		(select p_no, p_name, p_type, p_price, p_discount, color_code, size_code from product where p_no = #{p_no}) product inner join common_code on p_type = cc_no)
		inner join common_code on color_code = cc_no) inner join common_code on size_code = cc_no) end1 inner join
		(select p1.p_no, pi_route, pi_file from (select p_no ,min(pi_no) min_no from product_img group by (p_no) having p_no = #{p_no}) p1 inner join product_img p2 on p1.min_no = pi_no) end2
		on end2.p_no = end1.p_no
	</select>
	
	<select id="checkOnum" parameterType="order" resultType="String">
		select max(o_no) o_no from product_order
	</select>
	
	<insert id="orderInsert">
		insert into product_order(o_no, p_no, o_cnt, o_price, o_mode, o_confirm, m_no, o_num) 
		values(order_seq.nextval, #{p_no}, #{o_cnt}, #{o_price}, #{o_mode}, #{o_confirm}, #{m_no}, #{o_num})
	</insert>
</mapper>